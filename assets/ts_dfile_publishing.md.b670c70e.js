import{_ as s,c as a,o as n,b as o}from"./app.758655e4.js";const u=JSON.parse('{"title":"Publishing","description":"","frontmatter":{"title":"Publishing"},"headers":[{"level":2,"title":"1️⃣ 在你的npm包中包含声明","slug":"_1️⃣-在你的npm包中包含声明","link":"#_1️⃣-在你的npm包中包含声明","children":[]},{"level":2,"title":"2️⃣ 依赖","slug":"_2️⃣-依赖","link":"#_2️⃣-依赖","children":[]},{"level":2,"title":"3️⃣ Red flags","slug":"_3️⃣-red-flags","link":"#_3️⃣-red-flags","children":[{"level":3,"title":"包依赖声明","slug":"包依赖声明","link":"#包依赖声明","children":[]}]},{"level":2,"title":"4️⃣ 使用 typesVersion 进行版本选择","slug":"_4️⃣-使用-typesversion-进行版本选择","link":"#_4️⃣-使用-typesversion-进行版本选择","children":[{"level":3,"title":"4.1 文件夹重定向（使用 *）","slug":"_4-1-文件夹重定向-使用","link":"#_4-1-文件夹重定向-使用","children":[]},{"level":3,"title":"4.2 文件重定向","slug":"_4-2-文件重定向","link":"#_4-2-文件重定向","children":[]}]},{"level":2,"title":"5️⃣ 匹配行为","slug":"_5️⃣-匹配行为","link":"#_5️⃣-匹配行为","children":[]},{"level":2,"title":"6️⃣ 多个字段","slug":"_6️⃣-多个字段","link":"#_6️⃣-多个字段","children":[]},{"level":2,"title":"7️⃣ 发布到 @types","slug":"_7️⃣-发布到-types","link":"#_7️⃣-发布到-types","children":[]}],"relativePath":"ts/dfile/publishing.md","lastUpdated":1678257005000}'),l={name:"ts/dfile/publishing.md"},p=o(`<nav class="table-of-contents"><ul><li><a href="#_1️⃣-在你的npm包中包含声明">1️⃣ 在你的npm包中包含声明</a></li><li><a href="#_2️⃣-依赖">2️⃣ 依赖</a></li><li><a href="#_3️⃣-red-flags">3️⃣ Red flags</a><ul><li><a href="#包依赖声明">包依赖声明</a></li></ul></li><li><a href="#_4️⃣-使用-typesversion-进行版本选择">4️⃣ 使用 typesVersion 进行版本选择</a><ul><li><a href="#_4-1-文件夹重定向-使用">4.1 文件夹重定向（使用 *）</a></li><li><a href="#_4-2-文件重定向">4.2 文件重定向</a></li></ul></li><li><a href="#_5️⃣-匹配行为">5️⃣ 匹配行为</a></li><li><a href="#_6️⃣-多个字段">6️⃣ 多个字段</a></li><li><a href="#_7️⃣-发布到-types">7️⃣ 发布到 @types</a></li></ul></nav><p>假设你按照指南已经写了一个声明文件，现在该将它发布到npm上了。主要有2种将声明文件发布到npm的方式：</p><ol><li>打包你的npm包</li><li>发布到npm上的 <a href="https://www.npmjs.com/~types" target="_blank" rel="noreferrer">@types 组织</a></li></ol><p>如果你的类型是通过你的源代码生成的，发布源代码+类型。TypeScript和JavaScript项目都能通过 <a href="./../tsconfig/compiler/emit.html#declaration-👍">declaration</a> 编译选项生成类型😎。</p><p>否则，我们推荐将类型提交到 <code>DefinitelyTyped</code>，它会将类型发布到npm上的 <code>@types</code> 组织。</p><h2 id="_1️⃣-在你的npm包中包含声明" tabindex="-1">1️⃣ 在你的npm包中包含声明 <a class="header-anchor" href="#_1️⃣-在你的npm包中包含声明" aria-hidden="true">#</a></h2><p>如果你的包由一个主入口 <code>.js</code> 文件，则你需要在 <code>package.json</code> 中也指明主要的声明文件。📚 设置 <code>types</code> 属性指向打包好的声明文件。比如：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">awesome</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Vandelay Industries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./lib/main.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 包的主入口文件</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./lib/main.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 声明文件位置</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注意 <code>typings</code> 字段和 <code>types</code> 同义，因此也可以使用 <code>typings</code>。</p><p>另外，如果你的主要声明文件叫 <code>index.d.ts</code>，并存放在包的根目录（紧靠着 <code>index.js</code>）则你不需要标记 <code>types</code> 属性，但还是建议显式的标出声明文件路径。</p></div><h2 id="_2️⃣-依赖" tabindex="-1">2️⃣ 依赖 <a class="header-anchor" href="#_2️⃣-依赖" aria-hidden="true">#</a></h2><p>📚所有的依赖都通过npm管理。确保你所依赖的所有 <code>声明包</code> 都在 <code>package.json</code> 的 <code>dependencies</code> 中合适的标记出来。</p><p>🌰，假设你写了一个包，依赖<code>Browserify</code> 和 <code>TypeScript</code>:</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">browserify-typescript-extension</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Vandelay Industries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./lib/main.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./lib/main.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">dependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">browserify</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">latest</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">@types/browserify</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">latest</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">typescript</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">next</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>🤩 这里我们的包依赖 <code>browserify</code> &amp; <code>typescript</code>包。<code>browserify</code> 本身没有将它的声明文件和包打包在一起，因此我们需要依赖 <code>@types/browserify</code> 作为它的声明。<code>typescript</code> 包则本身就包含了声明文件，因此不需要额外的依赖了。</p><p>我们的包公开了其中每一个的声明，因此任何使用<code>browserify-typescript-extension</code>包的用户也需要有这些依赖项😅。基于这个原因，我们使用 <code>&quot;dependencies&quot;</code> 而不是 <code>&quot;devDependencies&quot;</code>， 否则我们的用户需要手动的下载安装这些包。如果我们仅仅是写一个CLI应用，而不期望我们的包用作为一个库，我们可能使用 <code>devDependencies</code>。</p><h2 id="_3️⃣-red-flags" tabindex="-1">3️⃣ Red flags <a class="header-anchor" href="#_3️⃣-red-flags" aria-hidden="true">#</a></h2><p>❌ <code>不要</code> 在你的声明文件中使用 <code>/// &lt;reference path=&quot;...&quot; /&gt;</code></p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">/// </span><span style="color:#89DDFF;font-style:italic;">&lt;</span><span style="color:#F07178;font-style:italic;">reference</span><span style="color:#89DDFF;font-style:italic;"> </span><span style="color:#C792EA;font-style:italic;">path</span><span style="color:#89DDFF;font-style:italic;">=</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#C3E88D;font-style:italic;">../typescript/lib/typescriptServices.d.ts</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#89DDFF;font-style:italic;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">....</span></span>
<span class="line"></span></code></pre></div><p>✅ <code>要</code> 使用 <code>/// &lt;reference types=&quot;...&quot; /&gt;</code>:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line highlighted"><span style="color:#676E95;font-style:italic;">/// </span><span style="color:#89DDFF;font-style:italic;">&lt;</span><span style="color:#F07178;font-style:italic;">reference</span><span style="color:#89DDFF;font-style:italic;"> </span><span style="color:#C792EA;font-style:italic;">types</span><span style="color:#89DDFF;font-style:italic;">=</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#C3E88D;font-style:italic;">typescript</span><span style="color:#89DDFF;font-style:italic;">&quot;</span><span style="color:#89DDFF;font-style:italic;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">....</span></span>
<span class="line"></span></code></pre></div><p>确保在回顾一下 <a href="./library-structure.html#_6️⃣-消费依赖">Cousuming dependencies</a> 了解更多。</p><h3 id="包依赖声明" tabindex="-1">包依赖声明 <a class="header-anchor" href="#包依赖声明" aria-hidden="true">#</a></h3><p>如果你的类型定义依赖另一个包：</p><ul><li>❌ <code>不要</code> 将它和你的类型定义合并，保持它们在各自文件中</li><li>❌ <code>不要</code> 将声明拷贝到你的的包中</li><li>✅ 如果npm类型声明包没有打包它的声明文件，则必须依赖npm类型声明包</li></ul><h2 id="_4️⃣-使用-typesversion-进行版本选择" tabindex="-1">4️⃣ 使用 <code>typesVersion</code> 进行版本选择 <a class="header-anchor" href="#_4️⃣-使用-typesversion-进行版本选择" aria-hidden="true">#</a></h2><p>当TypeScript打开 <code>package.json</code> 文件理清它需要读取哪个文件时，它首先查看 <code>typesVersions</code> 字段。</p><h3 id="_4-1-文件夹重定向-使用" tabindex="-1">4.1 文件夹重定向（使用 <code>*</code>） <a class="header-anchor" href="#_4-1-文件夹重定向-使用" aria-hidden="true">#</a></h3><p>包含 <code>typesVersions</code> 的 <code>package.json</code> 文件可能看起来如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">package-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">typesVersions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">&gt;=3.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts3.1/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>📚这个 <code>package.json</code> 告诉TypeScript首先检测当前TypeScript版本。如果它是 <code>3.1+</code>，TypeScript会找出相对你包的导入路径，然后从包的 <code>ts3.1</code> 文件夹中读取。</p><p>这正是 <code>{&quot;*&quot;: [&quot;ts3.1/*&quot;]}</code> 的含义 - 如果你熟悉 <a href="./../tsconfig/compiler/modules.html#paths-👍">path映射</a>，它工作原理类似。</p><p>上面例子，如果你从 <code>&quot;package-name&quot;</code> 导入，当运行TS3.1时，TypeScript将从 <code>[...]/node_modules/package-name/ts3.1/index.d.ts</code> （和其它相对路径）解析。如果从 <code>package-name/foo</code> 导入，我们将查找 <code>[...]/node_modules/package-name/ts3.1/foo.d.ts</code> 和 <code>[...]/node_modules/package-name/ts3.1/foo/index.d.ts</code> 文件。</p><p>假如你没有运行TS3.1呢？如果没有匹配上 <code>typesVersions</code>，TypeScript将再回退到 <code>types</code> 字段，因此<code>TS3.0</code>及以下版本将重定向到 <code>[...]/node_modules/package-name/index.d.ts</code> 文件。</p><h3 id="_4-2-文件重定向" tabindex="-1">4.2 文件重定向 <a class="header-anchor" href="#_4-2-文件重定向" aria-hidden="true">#</a></h3><p>当你只想对改变某个文件时，你可以告诉TypeScript要解析的文件不同于传入的确切文件名：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">package-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">typesVersions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">&lt;4.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index.v3.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>对<code>TS4.0+</code>，导入 <code>&quot;package-name&quot;</code> 将解析为 <code>./index.d.ts</code>，对 <code>TS3.9-</code> 将解析为 <code>&quot;./index.v3.d.ts&quot;</code>。</p><h2 id="_5️⃣-匹配行为" tabindex="-1">5️⃣ 匹配行为 <a class="header-anchor" href="#_5️⃣-匹配行为" aria-hidden="true">#</a></h2><p>TypeScript决定编译器和语言版本是否匹配的方法是使用Node的<a href="https://github.com/npm/node-semver#ranges" target="_blank" rel="noreferrer">semver ranges</a>。</p><h2 id="_6️⃣-多个字段" tabindex="-1">6️⃣ 多个字段 <a class="header-anchor" href="#_6️⃣-多个字段" aria-hidden="true">#</a></h2><p>📚 <code>typesVersions</code> 支持多个字段，每个字段名指定一个匹配区间：</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">package-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">typesVersion</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">&gt;=3.2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts3.2/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">&gt;=3.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts3.1/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>因为范围可能重叠，决定导入那个文件<code>和指定的顺序有关</code>。这意味着，上面的例子，即使 <code>&gt;=3.2</code> 和 <code>&gt;=3.1</code> 同时匹配支持TS3.2和以上，<code>反转顺序会导致不同的行为</code>😅。因此上面的例子不等价于：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines" tabindex="0"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">package-name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">typesVersion</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">// 🚨 这不能正常工作！顺序很重要！！！</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">&gt;=3.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts3.1/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]},</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">&gt;=3.2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F78C6C;">*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts3.2/*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]}</span></span>
<span class="line highlighted"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="_7️⃣-发布到-types" tabindex="-1">7️⃣ 发布到 @types <a class="header-anchor" href="#_7️⃣-发布到-types" aria-hidden="true">#</a></h2><p>在 <a href="https://www.npmjs.com/~types" target="_blank" rel="noreferrer">@types</a>组织下的包会通过 <a href="https://github.com/microsoft/DefinitelyTyped-tools/tree/master/packages/publisher" target="_blank" rel="noreferrer">types-publisher工具</a> 自动从 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noreferrer">DefinitelyTyped</a> 发布。为了让你的声明作为 @types包被发布，请向 <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noreferrer">DefinitelyTyped</a> 提供一个PR.</p><p>原文档：</p><ul><li><a href="https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html" target="_blank" rel="noreferrer">Publishing</a></li></ul><p>2022年09月04日17:35:57</p>`,49),e=[p];function t(c,r,D,y,F,i){return n(),a("div",null,e)}const h=s(l,[["render",t]]);export{u as __pageData,h as default};
