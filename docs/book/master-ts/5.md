---
title: æ¨¡å¼åŒ¹é…
---

TypeScript ç±»å‹ç¼–ç¨‹çš„ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒå¤æ‚ï¼Œä½†å…¶å®è¿™äº›é€»è¾‘ç”¨ JS å¤§å®¶éƒ½ä¼šå†™ï¼Œä¹‹æ‰€ä»¥åˆ°äº†ç±»å‹ä½“æ“å°±ä¸ä¼šäº†ï¼Œé‚£æ˜¯å› ä¸ºè¿˜ä¸ç†Ÿæ‚‰ä¸€äº›å¥—è·¯ã€‚

æ‰€ä»¥ï¼Œè¿™èŠ‚å¼€å§‹æˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸€äº›ç±»å‹ä½“æ“çš„å¥—è·¯ï¼Œç†Ÿæ‚‰è¿™äº›å¥—è·¯ä¹‹åï¼Œå„ç§ç±»å‹ä½“æ“é€»è¾‘å°±èƒ½å¤Ÿå¾ˆé¡ºç•…çš„å†™å‡ºæ¥ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ç±»å‹ä½“æ“çš„ç¬¬ä¸€ä¸ªå¥—è·¯ï¼šæ¨¡å¼åŒ¹é…åšæå–ã€‚



## æ¨¡å¼åŒ¹é…

æˆ‘ä»¬çŸ¥é“ï¼Œå­—ç¬¦ä¸²å¯ä»¥å’Œæ­£åˆ™åšæ¨¡å¼åŒ¹é…ï¼Œæ‰¾åˆ°åŒ¹é…çš„éƒ¨åˆ†ï¼Œæå–å­ç»„ï¼Œä¹‹åå¯ä»¥ç”¨ 1,1,2 ç­‰å¼•ç”¨åŒ¹é…çš„å­ç»„ã€‚

```js
'abc'.replace('/a(b)c/)', '$1,$1,$1')
// å¾—åˆ°
// 'b,b,b'
```

Typescript çš„ç±»å‹ä¹ŸåŒæ ·å¯ä»¥åšæ¨¡å¼åŒ¹é…ã€‚

æ¯”å¦‚è¿™æ ·ä¸€ä¸ª Promise ç±»å‹ï¼š

```typescript
type p = Promise<'guang'>
```

æˆ‘ä»¬æƒ³æå– value çš„ç±»å‹ï¼Œå¯ä»¥è¿™æ ·åšï¼š

```typescript
type GetValueType<P> = P extends Primise<infer Value> ? Value : never
```

é€šè¿‡ extends å¯¹ä¼ å…¥çš„ç±»å‹å‚æ•° P åšæ¨¡å¼åŒ¹é…ï¼Œå…¶ä¸­å€¼çš„ç±»å‹æ˜¯éœ€è¦æå–çš„ï¼Œé€šè¿‡ infer å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ Value æ¥ä¿å­˜ï¼Œå¦‚æœåŒ¹é…ï¼Œå°±è¿”å›åŒ¹é…åˆ°çš„ Valueï¼Œå¦åˆ™å°±è¿”å› never ä»£è¡¨æ²¡åŒ¹é…åˆ°ã€‚

![æ¨¡å¼åŒ¹é…å®ä¾‹](./imgs/5-1.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/FAFwngDgpgBA4lEA1AhgGwK5QCqSgHgAUA+GAXhkJigA8QoA7AEwGdKAnAewFsBLFgrwYAzKOxipMUUgH4J6LDABcMBlABuYgNzBd4aPESSsAJSgsMaEOUPIFOPES58B+AOQBzDCgYe3xYi0gA)

::: tip

TSv4.5ç‰ˆæœ¬å¼•å…¥äº† [Awaited\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#awaitedtype) å®ç°äº†ä¸Šé¢ç±»ä¼¼çš„åŠŸèƒ½

``` typescript
type GetValueResult = Awaited<Promise<'guang'>>
```

:::

è¿™å°±æ˜¯ Typescript ç±»å‹çš„æ¨¡å¼åŒ¹é…ï¼š

**ğŸ“š Typescript ç±»å‹çš„æ¨¡å¼åŒ¹é…æ˜¯é€šè¿‡ `extends` å¯¹ç±»å‹å‚æ•°åšåŒ¹é…ï¼Œç»“æœä¿å­˜åˆ°é€šè¿‡ `infer` å£°æ˜çš„å±€éƒ¨ç±»å‹å˜é‡é‡Œï¼Œå¦‚æœåŒ¹é…å°±èƒ½ä»è¯¥å±€éƒ¨å˜é‡é‡Œæ‹¿åˆ°æå–å‡ºçš„ç±»å‹ã€‚**

è¿™ä¸ªæ¨¡å¼åŒ¹é…çš„å¥—è·¯æœ‰å¤šæœ‰ç”¨å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨æ•°ç»„ã€å­—ç¬¦ä¸²ã€å‡½æ•°ã€æ„é€ å™¨ç­‰ç±»å‹é‡Œçš„åº”ç”¨ã€‚



## æ•°ç»„ç±»å‹



### First

æ•°ç»„ç±»å‹æƒ³æå–ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹æ€ä¹ˆåšå‘¢ï¼Ÿ

```typescript
type arr = [1,2,3]
```

ç”¨å®ƒæ¥åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œæå–ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹åˆ°é€šè¿‡ infer å£°æ˜çš„å±€éƒ¨å˜é‡é‡Œè¿”å›ã€‚

``` typescript
type GetFirst<Arr extends unknown[]> = 
	Arr extends [infer First, ...unknown[]] ? First : never
```

::: tip

**`any` å’Œ `unknown` çš„åŒºåˆ«**ï¼š 

- any å’Œ unknown éƒ½ä»£è¡¨ä»»æ„ç±»å‹ï¼Œä½†æ˜¯ unknown åªèƒ½æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ï¼Œè€Œ any é™¤äº†å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™ä»»æ„ç±»å‹ï¼ˆé™¤äº† neverï¼‰ã€‚ç±»å‹ä½“æ“ä¸­ç»å¸¸ç”¨ unknown æ¥å—å’ŒåŒ¹é…ä»»ä½•ç±»å‹ï¼Œè€Œå¾ˆå°‘æŠŠä»»ä½•ç±»å‹èµ‹å€¼ç»™æŸä¸ªç±»å‹å˜é‡ã€‚

:::

å¯¹ Arr åšæ¨¡å¼åŒ¹é…ï¼ŒæŠŠæˆ‘ä»¬è¦æå–çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç±»å‹æ”¾åˆ°é€šè¿‡ infer å£°æ˜çš„ First å±€éƒ¨å˜é‡é‡Œï¼Œåé¢çš„å…ƒç´ å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œç”¨ unknown æ¥æ”¶ï¼Œç„¶åæŠŠå±€éƒ¨å˜é‡ First è¿”å›ã€‚

å½“ç±»å‹å‚æ•° Arr ä¸º [1,2,3] æ—¶ï¼š

![First example 1](./imgs/5-2.webp)

å½“ç±»å‹å‚æ•° Arr ä¸º [] æ—¶ï¼š

![First example 2](./imgs/5-3.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBA4hwDECWAnAzsAPAQRSqEAHsBAHYAmaUArqQNakD2A7qQNoC6AfFALxS58REhSpskpAGYR8ydMAA0UAHSraDFuw4coAfihyMUAFxRSEAG4yA3ACh7oSLHiHgAJQhpqAG2B9niKgYmGwAjAoATAoAzNx2to7QcIHyHl6+Ef7JriFxtkA)



### Last

å¯ä»¥æå–ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æå–æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¿®æ”¹ä¸‹æ¨¡å¼ç±»å‹å°±è¡Œï¼š

```typescript
type GetLast<Arr extends unknown[]> =
  Arr extends [...unknown[], infer Last] ? Last : never;

// type GetLastResult = 3
type GetLastResult = GetLast<[1, 2, 3]>

// type GetLastResult = never
type GetLastResult = GetLast<[]>
```

![Last Example](./imgs/5-4.webp)



### PopArr

æˆ‘ä»¬åˆ†åˆ«å–äº†é¦–å°¾å…ƒç´ ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å–å‰©ä½™çš„æ•°ç»„ï¼Œæ¯”å¦‚å–`å»æ‰äº†æœ€åä¸€ä¸ªå…ƒç´ `çš„æ•°ç»„ï¼š

```typescript
type PopArr<Arr extends unknown[]> =
  Arr extends []
    ? []
    : Arr extends [...infer Rest, unknown] 
      ? Rest : never

// type PopResult = [1, 2]
type PopResult = PopArr<[1, 2, 3]>

// type PopResult = []
type PopResult2 = PopArr<[]>
```

å¦‚æœæ˜¯ç©ºæ•°ç»„ï¼Œå°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™åŒ¹é…å‰©ä½™çš„å…ƒç´ ï¼Œæ”¾åˆ° infer å£°æ˜çš„å±€éƒ¨å˜é‡ Rest é‡Œï¼Œè¿”å› Restã€‚

![PopArr Example 1](./imgs/5-5.webp)

![PopArr Example 2](./imgs/5-6.webp)



- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBACg9mAggJ2QHhcqEAewIB2AJgM5QCuBA1gXAO4EDaAugHxQC8Um2ehpUFlAD8g5lABc3VL3zEyjAHTKAlgQBmELACUIJYABoK1Wg3Gjd+yVAIQAbloDcAKFehIsBJfIAbYJ08kVDRGAEYDACYDAGY2FzdwaHgwbz8IgOTMELigA)



### ShiftArr

åŒç†å¯å¾— ShiftArr çš„å®ç°ï¼ˆå»æ‰ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰ï¼š

```typescript
type ShiftArr<Arr extends unknown[]> =
  Arr extends []
    ? []
    : Arr extends [unknown, ...infer Rest]
      ? Rest
      : never

// type ShiftResult = [2, 3]
type ShiftResult = ShiftArr<[1, 2, 3]>

// type ShiftResult2 = []
type ShiftResult2 = ShiftArr<[]>
```

![ShiftArr](./imgs/5-7.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/FAFwngDgpgBAygCwJYDMQEEBOmA8XMxQAeIUAdgCYDOMArmQNZkD2A7mQNoC6AfDALwx8hEuWoxuMAPwSuMAFxDsI0pRod6TNmQA0MAHSGkZFFAIAlKFRByZl6wphkoANzMBuYF-DR4yNPa0ADYgAn6oGNg4HACMOgBMOgDMvJ6gkLCIEYEh8WFZaPjRqUA)



## å­—ç¬¦ä¸²ç±»å‹

å­—ç¬¦ä¸²ç±»å‹ä¹ŸåŒæ ·å¯ä»¥åšæ¨¡å¼åŒ¹é…ï¼ŒåŒ¹é…ä¸€ä¸ªæ¨¡å¼å­—ç¬¦ä¸²ï¼ŒæŠŠéœ€è¦æå–çš„éƒ¨åˆ†æ”¾åˆ° `infer` å£°æ˜çš„å±€éƒ¨å˜é‡é‡Œã€‚



### StartsWith

åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä»¥æŸä¸ªå‰ç¼€å¼€å¤´ï¼Œä¹Ÿæ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…ï¼š

```typescript
type StartsWith<Str extends string, Prefix extends string>
	= Str extends `${Prefix}${string}` ? ture : false;


// type StartsWithResult = true
type StartsWithResult = StartsWith<'guang and dong', 'guang'>

// type StartsWithResult2 = false
type StartsWithResult2 = StartsWith<'guang and dong', 'dong'>
```

éœ€è¦å£°æ˜å­—ç¬¦ä¸² Strã€åŒ¹é…çš„å‰ç¼€ Prefix ä¸¤ä¸ªç±»å‹å‚æ•°ï¼Œå®ƒä»¬éƒ½æ˜¯ stringã€‚

ç”¨ Str å»åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œ`æ¨¡å¼ç±»å‹çš„å‰ç¼€æ˜¯ Prefixï¼Œåé¢æ˜¯ä»»æ„çš„ string`ï¼Œå¦‚æœåŒ¹é…è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚

![StartsWith 1](./imgs/5-8.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBAysCGAnYBnA6gS2ACwDx0SggA9gIA7AExShWEQ3IHMAaKABUQgDMNijSFarXqMmAPigBeWPQFkqNAAYASAN6cefAL7q6DZtqVQA-FHoBXaAC4o3eABsUEANwAoD6EiykqTDgAlCBQLB2BpH2R0LDwAciYLeGYoJMooSgB7Zli2eMTs8XcPNy9oOF9owODQ4AAmCPKo-ziEpKYUqnSsphyoWMyClyA)



### Replace

å­—ç¬¦ä¸²å¯ä»¥åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œæå–æƒ³è¦çš„éƒ¨åˆ†ï¼Œè‡ªç„¶ä¹Ÿå¯ä»¥ç”¨è¿™äº›å†æ„æˆä¸€ä¸ªæ–°çš„ç±»å‹ã€‚

æ¯”å¦‚å®ç°å­—ç¬¦ä¸²æ›¿æ¢ï¼š

```typescript
type Replace<
  Str extends string,
  From extends string,
  To extends string
> = Str extends `${infer Prefix}${From}${infer Suffix}` 
	? `${Prefix}${To}${Suffix}` 
	: Str;

// åŒ¹é…ä¸Š
type ReplaceResult = ReplaceStr<"Guangguang's best friend is ?", "?", "Dongdong">

// æ²¡åŒ¹é…ä¸Š
type ReplaceResult2 = ReplaceStr<"abc", "?", "Dongdong">;
```

å£°æ˜è¦æ›¿æ¢çš„å­—ç¬¦ä¸² Strã€å¾…æ›¿æ¢çš„å­—ç¬¦ä¸² Fromã€æ›¿æ¢æˆçš„å­—ç¬¦ä¸² 3 ä¸ªç±»å‹å‚æ•°ï¼Œé€šè¿‡ extends çº¦æŸä¸ºéƒ½æ˜¯ string ç±»å‹ã€‚

ç”¨ Str å»åŒ¹é…æ¨¡å¼ä¸²ï¼Œæ¨¡å¼ä¸²ç”± From å’Œä¹‹å‰ä¹‹åçš„å­—ç¬¦ä¸²æ„æˆï¼ŒæŠŠä¹‹å‰ä¹‹åçš„å­—ç¬¦ä¸²æ”¾åˆ°é€šè¿‡ infer å£°æ˜çš„å±€éƒ¨å˜é‡ Prefixã€Suffix é‡Œã€‚

ç”¨ Prefixã€Suffix åŠ ä¸Šæ›¿æ¢åˆ°çš„å­—ç¬¦ä¸² To æ„é€ æˆæ–°çš„å­—ç¬¦ä¸²ç±»å‹è¿”å›ã€‚

å½“åŒ¹é…æ—¶ï¼š

![Replace 1](./imgs/5-9.webp)

æ²¡åŒ¹é…ä¸Šï¼Œè¿”å›åŸå­—ç¬¦ä¸²ï¼š

![Replace 2](./imgs/5-10.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBAShYBsCGBjCBlYAnAPJrUEAHsBAHYAmAzlFdgJZkDmANFAGJYD2AtoSeWq0GzNgBUu-UpRp0sjJgD4oAXihR8UwTQAGAEgDejAGYQCABSwRj9IgF9DnXg6NlTBdAFdjN+zqgA-FD6BpbWti4SLl4+Ef4AXBrYANwAUOmpoJCw8MhocFSeCMCqOYioGNg4AEQA4p5IzEwNzADkNABGEHRQxvKCUPQ0AdVs1SNjACJczBQzTNWKaZng0HDl+d1FwABMpet5lbjVSB0oo1DjF9XTs-OLyUA)



### Trim

èƒ½å¤ŸåŒ¹é…å’Œæ›¿æ¢å­—ç¬¦ä¸²ï¼Œé‚£ä¹Ÿå°±èƒ½å®ç°å»æ‰ç©ºç™½å­—ç¬¦çš„ Trimï¼š

ä¸è¿‡å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“æœ‰å¤šå°‘ä¸ªç©ºç™½å­—ç¬¦ï¼Œæ‰€ä»¥åªèƒ½ä¸€ä¸ªä¸ªåŒ¹é…å’Œå»æ‰ï¼Œéœ€è¦é€’å½’ã€‚

å…ˆå®ç° `TrimRight`:

``` typescript
type TrimStrRight<Str extends string> =
  Str extends `${infer Rest}${' ' | '\n' | '\t'}`
    ? TrimStrRight<Rest>
    : Str;

// type TrimRightResult = 'guang'
type TrimRightResult = TrimStrRight<'guang   '>
```

ç±»å‹å‚æ•° Str æ˜¯è¦ Trim çš„å­—ç¬¦ä¸²ã€‚

å¦‚æœ Str åŒ¹é…å­—ç¬¦ä¸² + ç©ºç™½å­—ç¬¦ (ç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦)ï¼Œé‚£å°±æŠŠå­—ç¬¦ä¸²æ”¾åˆ° infer å£°æ˜çš„å±€éƒ¨å˜é‡ Rest é‡Œã€‚

æŠŠ Rest ä½œä¸ºç±»å‹å‚æ•°é€’å½’ TrimRightï¼Œç›´åˆ°ä¸åŒ¹é…ï¼Œè¿™æ—¶çš„ç±»å‹å‚æ•° Str å°±æ˜¯å¤„ç†ç»“æœã€‚

![TrimStrRight](./imgs/5-11.webp)



åŒç†å¯å¾— `TrimLeft`ï¼š

```typescript
type TrimStrLeft<Str extends string> =
  Str extends `${' ' | '\n' | '\t'}${infer Rest}`
    ? TrimStrLeft<Rest>
    : Str;

// type TrimRightResult = 'guang'
type TrimLeftResult = TrimStrLeft<'  guang'>
```

![TrimStrLeft](./imgs/5-12.webp)

TrimRight å’Œ TrimLeft ç»“åˆå°±æ˜¯ `Trim`ï¼šğŸ‰

```typescript
type TrimStr<Str extends string> =TrimStrRight<TrimStrLeft<Str>>
```

![TrimStr](./imgs/5-13.webp)



- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBAKgTgSwLYGVhwEoIOYAtgA8acUEAHsBAHYAmAzlHegldgHxQC8UxpF19KAAMAJAG8WAMwgkMEJgF9xAciiqAPmoA6VDduDKFQqAH5YiVOix5CcphwBcPdAG4AUB7ehI55Nfx2AK4ANsBcvpaYOPgEytiBAIasUCmpKcps7h7e0PDIxAAyEJKEvOSUtAxMiKwc3GX8lcIqalCayjp6HQZKElTSsvLARqYRhcW2Q47OcFle4LkWRSVBoeF5kcuEqmlQNAD2rBlz2Qtj6ETofBWC1SzsXBvE-oRP6FuXcGyZnjkRq2FuG84LFdntDthUsc3EA)



## å‡½æ•°

å‡½æ•°åŒæ ·ä¹Ÿå¯ä»¥åšç±»å‹åŒ¹é…ï¼Œæ¯”å¦‚æå–å‚æ•°ã€è¿”å›å€¼çš„ç±»å‹ã€‚



### GetParameters

å‡½æ•°ç±»å‹å¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æ¥æå–å‚æ•°çš„ç±»å‹ï¼š

```typescript
type GetParameters<Func extends Function> = 
	Func extends (...args: infer Args) => unknown ? Args : never;

// è¿”å›ä¸€ä¸ªå…ƒç¥–ç±»å‹
// type ParametersResult = [name: string, age: number]
type ParametersResult = GetParameters<(name: string, age: number) => string>;
```

ç±»å‹å‚æ•° Func æ˜¯è¦åŒ¹é…çš„å‡½æ•°ç±»å‹ï¼Œé€šè¿‡ extends çº¦æŸä¸º Functionã€‚

Func å’Œæ¨¡å¼ç±»å‹åšåŒ¹é…ï¼Œå‚æ•°ç±»å‹æ”¾åˆ°ç”¨ infer å£°æ˜çš„å±€éƒ¨å˜é‡ Args é‡Œï¼Œè¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œç”¨ unknownã€‚

è¿”å›æå–åˆ°çš„å‚æ•°ç±»å‹ Argsã€‚

![GetParamters](./imgs/5-14.webp)



- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBA4hwAUCGAnJBbeEUGcA8AYgK4B2AxlBAB7AQkAmOUx5wAlgPYkB8UAvM1IVqtBkwAUAOmmoA5jgBcUNiQBm2KAEEU8gJT9epANYkOAdxJQA-Fp1MlJCADdsAbgBQn0JCjI0mWlwAJQgcIgAbYH5YeD8MLFw8cRJ4pRxgFBVZABooJFkIByJ0ACNsfT5edMySWW4Pd29oOIDsHBCwyIAmaLhEVHjA-HEKqoys+qA)

::: tip

TS3.1 æ·»åŠ äº† [Paramters\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#parameterstype) ç±»ä¼¼åŠŸèƒ½ã€‚

:::


### GetReturnType

èƒ½æå–å‚æ•°ç±»å‹ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æå–è¿”å›å€¼ç±»å‹ï¼š

``` typescript
type GetReturnType<Func extends Function> = 
  // è¿™é‡Œå‚æ•°ç”¨çš„æ˜¯any
  Func extends (...args: any[]) => infer R ? R : never

// type Result = 'dong'
type Result = GetReturnType<() => 'dong'>
```

Func å’Œæ¨¡å¼ç±»å‹åšåŒ¹é…ï¼Œæå–è¿”å›å€¼åˆ°é€šè¿‡ infer å£°æ˜çš„å±€éƒ¨å˜é‡ ReturnType é‡Œè¿”å›ã€‚

å‚æ•°ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ `any[]`ï¼ˆğŸš¨æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½ç”¨ unknownï¼Œè¿™é‡Œçš„è§£é‡Šæ¶‰åŠåˆ°å‚æ•°çš„é€†å˜æ€§è´¨ï¼Œå…·ä½“åŸå› é€†å˜é‚£ä¸€èŠ‚ä¼šè§£é‡Šï¼‰ã€‚

![ReturnType](./imgs/5-15.webp)



- [TS Playgroundd](https://www.typescriptlang.org/play?#code/C4TwDgpgBA4hwCV4FcBOA7AKuCAeAYsugMZQQAewE6AJgM5SEnACWA9ugHxQC8jRpClVoMAFADpJAQ1QBzOgC4oU9CADaAXQCUvbi3QAzCKihJgaLDigB+UygzZIUJeggA3YwG4AUN9BOzC0cIJDpkABtw4F5YeECHHFxRdCkAWwglOmBUfVkdHm4AchoOWULOTyA)

::: tip

TSå·¥å…·ç±»å‹ [ReturnType\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#returntypetype)

:::

### GetThisParameterType

æ–¹æ³•é‡Œå¯ä»¥è°ƒç”¨ `this`ï¼Œæ¯”å¦‚è¿™æ ·ï¼š

```js
class Dong {
    name: string;

    constructor() {
        this.name = "dong";
    }

    hello() {
        return 'hello, I\'m ' + this.name;
    }
}

const dong = new Dong();
dong.hello();
```

ç”¨`å¯¹è±¡.æ–¹æ³•å`çš„æ–¹å¼è°ƒç”¨çš„æ—¶å€™ï¼Œthis å°±æŒ‡å‘é‚£ä¸ªå¯¹è±¡ã€‚

ä½†æ˜¯æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨ call æˆ–è€… apply è°ƒç”¨ï¼š

```typescript
class Dong {
    name: string;

    constructor() {
        this.name = "dong";
    }

    hello() {
        return 'hello, I\'m ' + this.name;
    }
}

const dong = new Dong();
dong.hello();

dong.hello.call({xxx: 1}) // [!code ++]
```

call è°ƒç”¨çš„æ—¶å€™ï¼Œthis å°±å˜äº†ï¼Œä½†è¿™é‡Œå´æ²¡æœ‰è¢«æ£€æŸ¥å‡ºæ¥ this æŒ‡å‘çš„é”™è¯¯ã€‚

å¦‚ä½•è®©ç¼–è¯‘å™¨èƒ½å¤Ÿæ£€æŸ¥å‡º this æŒ‡å‘çš„é”™è¯¯å‘¢ï¼Ÿ

å¯ä»¥åœ¨æ–¹æ³•å£°æ˜æ—¶æŒ‡å®š this çš„ç±»å‹ï¼š

```typescript
class Dong {
  name: string

  constructor(name: string) {
    this.name = name
  }

  hello() { // [!code --]
  hello(this: Dong) { // [!code ++]
    return 'Hello, I\'m ' + this.name
  }
}

const dong = new Dong('dong')
dong.hello()

dong.hello.call({xxx: 1}) // [!code error]
```

è¿™æ ·ï¼Œå½“ call/apply è°ƒç”¨çš„æ—¶å€™ï¼Œå°±èƒ½æ£€æŸ¥å‡º this æŒ‡å‘çš„å¯¹è±¡æ˜¯å¦æ˜¯å¯¹çš„ï¼š

![strictBindCallApply](./imgs/5-16.webp)

å¦‚æœæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜æ²¡å¼€å¯ strictBindCallApply çš„ç¼–è¯‘é€‰é¡¹ï¼Œè¿™ä¸ªæ˜¯æ§åˆ¶æ˜¯å¦æŒ‰ç…§åŸå‡½æ•°çš„ç±»å‹æ¥æ£€æŸ¥ bindã€callã€apply

![strictBindCallApply](./imgs/5-17.webp)

è¿™é‡Œçš„ `this` ç±»å‹åŒæ ·ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æå–å‡ºæ¥ï¼š

```typescript
type GetThisParameterType<T>
  = T extends (this: infer ThisType, ...args: any[]) => any
      ? ThisType
      : unknown;
```

ç±»å‹å‚æ•° T æ˜¯å¾…å¤„ç†çš„ç±»å‹ã€‚

ç”¨ T åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œæå– this çš„ç±»å‹åˆ° infer å£°æ˜çš„å±€éƒ¨å˜é‡ ThisType ä¸­ï¼Œå…¶ä½™çš„å‚æ•°æ˜¯ä»»æ„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ anyï¼Œè¿”å›å€¼ä¹Ÿæ˜¯ä»»æ„ç±»å‹ã€‚

è¿”å›æå–åˆ°çš„ ThisTypeã€‚

è¿™æ ·å°±èƒ½æå–å‡º this çš„ç±»å‹ï¼š

```typescript
type GetThisParameterTypeRes = GetThisParameterType<typeof dong.hello>
```

![GetThisParameterType](./imgs/5-18.webp)



- [TS Playground](https://www.typescriptlang.org/play?#code/MYGwhgzhAEAiD2A7A5tA3gKGt6iwFsBTALmggBcAnASxQG4MsdgkLKBXYc+SgCgEp0THDnIALahAB0eItAC80AEQATJMiUMRAX0YixhECHi9xk0ghSDMIkZULl2lRNADkBo-AA00AJIAdV3w3aABqaDNpWUItHF1dDBZECmg1FAVcQgB3OHUBBjTkKQ9jfMZC4sNjKWAwI140AA9m4gBGbX4GDHIATwAHQmgAcQcAFQkIAAUwSgIHQkpR-sIAHlGAPgzR6EJG8kJEFRhTCdJaADMF6HHJJYGfKUeZ5AhSMEQegG0AXUF5TfePWgAH5rhM7oNSOxEABrRDwLKILrdZbDMYTaazIj7RbLABKhBgihG5BuUxmcxxEJWvQG8HOqXUlU862RQA)

::: tip

TSä¸­å­˜åœ¨ [ThisParameterType\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#thisparametertypetype) å·¥å…·ç±»å‹

:::

## æ„é€ å™¨

æ„é€ å™¨å’Œå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼Œæ„é€ å™¨æ˜¯ç”¨äºåˆ›å»ºå¯¹è±¡çš„ï¼Œæ‰€ä»¥å¯ä»¥è¢« `new`ã€‚

åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…æå–æ„é€ å™¨çš„å‚æ•°å’Œè¿”å›å€¼çš„ç±»å‹ï¼š



### GetInstanceType

æ„é€ å™¨ç±»å‹å¯ä»¥ç”¨ interface å£°æ˜ï¼Œä½¿ç”¨ `new(): xx` çš„è¯­æ³•ã€‚æ¯”å¦‚ï¼š

``` typescript {6}
interface Person {
  name: string;
}

interface PersonConstructor {
  new(name: string): Person
}
```

è¿™é‡Œçš„ PersonConstructor è¿”å›çš„æ˜¯ Person ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…å–å‡ºæ¥ã€‚

```typescript
type GetInstanceType<
  Ctor extends new (...args: any[]) => any
> = Ctor extends new (...args: any[]) => infer InstanceType
      ? InstanceType
      : any

type GetInstanceTypeRes = GetInstanceType<PersonConstructor>
```

ç±»å‹å‚æ•° ConstructorType æ˜¯å¾…å¤„ç†çš„ç±»å‹ï¼Œé€šè¿‡ extends çº¦æŸä¸ºæ„é€ å™¨ç±»å‹ã€‚

ç”¨ ConstructorType åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œæå–è¿”å›çš„å®ä¾‹ç±»å‹åˆ° infer å£°æ˜çš„å±€éƒ¨å˜é‡ InstanceType é‡Œï¼Œè¿”å› InstanceTypeã€‚

è¿™æ ·å°±èƒ½å–å‡ºæ„é€ å™¨å¯¹åº”çš„å®ä¾‹ç±»å‹ï¼š

![GetInstanceType](./imgs/5-19.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBA4hwEkB2BnYBDJBjCAVcEAPAMID2qwATgK5bCmX6RQQAewESAJilEhAHcoACgB049JQDmKAFxRMIAJRQAvAD4FSEJoBQUA2qhkKNOgybQ2Hbr35CxE6XK3K1mgJZIAZhEpRkNEwcSyh9QwiAfgCKYLwCMIiI+UUAbl1dLw5Kb3QcKAAFPxRyKABvcIMkdABbCHk0Si8pdIBfDKy-XPyiyhKkE0baen8KiPtharqGqmaleV7+tozQZjhEWOx4yAAlCF5VWHhAjC3LQkXyQaphhnV0oA)

::: tip

TSå­˜åœ¨ [InstanceType\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#instancetypetype) å·¥å…·ç±»å‹

:::



### GetConstructorParameters

GetInstanceType æ˜¯æå–æ„é€ å™¨è¿”å›å€¼ç±»å‹ï¼Œé‚£åŒæ ·ä¹Ÿå¯ä»¥æå–æ„é€ å™¨çš„å‚æ•°ç±»å‹ï¼š

``` typescript
type GetConstructorParameters<
  Ctor extends new (...args: any[]) => any
> = Ctor extends new (...args: infer ParametersType) => any
  ? ParametersType
  : any


interface Person {
  name: string;
}
interface PersonCtor {
  new (name: string): Person
}

// è¿”å›ä¸€ä¸ªå…ƒç¥–
// type Result = [name: string]
type Result = GetConstructorParameters<PersonCtor>
```

ç±»å‹å‚æ•° ConstructorType ä¸ºå¾…å¤„ç†çš„ç±»å‹ï¼Œé€šè¿‡ extends çº¦æŸä¸ºæ„é€ å™¨ç±»å‹ã€‚

ç”¨ ConstructorType åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œæå–å‚æ•°çš„éƒ¨åˆ†åˆ° infer å£°æ˜çš„å±€éƒ¨å˜é‡ ParametersType é‡Œï¼Œè¿”å› ParametersTypeã€‚

è¿™æ ·å°±èƒ½æå–å‡ºæ„é€ å™¨å¯¹åº”çš„å‚æ•°ç±»å‹ï¼š

![GetConstructorParameters](./imgs/5-20.webp)

- [TS Playground](https://www.typescriptlang.org/play?#code/C4TwDgpgBA4hwGED2A7AzsATgVwMbCUwAUBDTEgW3gkzQB4AoKZqZdLPAzAFXGggAewCCgAmaKCggB3KAAoAdErIBzNAC4oJFCACUUALwA+LToYmDrVBhz5CvSFEHCxEqbMXLMazQEsUAGY0UKTkVMK0DhD6xqYgTCwA-CFklNSRfAnMmlIAbjQA3AwM-hEBJLjQRDRoqFAA3lmSaZo2-ipFAL7FpTTllSE1qGw2nIQNTe5yKC1QbSgquprVtKhdxaCOcIjWHHbEqeE1AEoQEpbbI3tcoWkR9Cu1KFe2XEZFQA)

::: tip

TSå­˜åœ¨ [ConstructorParameters\<Type>](https://www.typescriptlang.org/docs/handbook/utility-types.html#constructorparameterstype) å·¥å…·ç±»å‹ã€‚

:::



## ç´¢å¼•ç±»å‹

ç´¢å¼•ç±»å‹ä¹ŸåŒæ ·å¯ä»¥ç”¨æ¨¡å¼åŒ¹é…æå–æŸä¸ªç´¢å¼•çš„å€¼çš„ç±»å‹ï¼Œè¿™ä¸ªç”¨çš„ä¹ŸæŒºå¤šçš„ï¼Œæ¯”å¦‚ React çš„ index.d.ts é‡Œçš„ `PropsWithRef` çš„é«˜çº§ç±»å‹ï¼Œå°±æ˜¯é€šè¿‡æ¨¡å¼åŒ¹é…æå–äº† ref çš„å€¼çš„ç±»å‹ï¼š

![PropsWithRef](./imgs/5-20.webp)

æˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹é‚£ä¸ªé«˜çº§ç±»å‹ï¼Œæå– Props é‡Œ ref çš„ç±»å‹ï¼š



### GetRefProps

æˆ‘ä»¬åŒæ ·é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼æå– ref çš„å€¼çš„ç±»å‹ï¼š

```typescript
type GetRefProps<Props> = 
  'ref' extends keyof Props // Propsä¸­æ˜¯å¦å­˜åœ¨ 'ref' å±æ€§
    ? Props extends { ref?: infer Value | undefined } // å¯¹refçš„å€¼è¿›è¡Œæ¨æ–­
      ? Value
      : never
    : never
```

ç±»å‹å‚æ•° Props ä¸ºå¾…å¤„ç†çš„ç±»å‹ã€‚

é€šè¿‡ keyof Props å–å‡º Props çš„æ‰€æœ‰ç´¢å¼•æ„æˆçš„è”åˆç±»å‹ï¼Œåˆ¤æ–­ä¸‹ ref æ˜¯å¦åœ¨å…¶ä¸­ï¼Œä¹Ÿå°±æ˜¯ 'ref' extends keyof Propsã€‚

ä¸ºä»€ä¹ˆè¦åšè¿™ä¸ªåˆ¤æ–­ï¼Œä¸Šé¢æ³¨é‡Šé‡Œå†™äº†ï¼š

```js
// need to check first if `ref` is a valid prop for ts@3.0
// otherwise it will infer `{}` instead of `never`
```

åœ¨ ts3.0 é‡Œé¢å¦‚æœæ²¡æœ‰å¯¹åº”çš„ç´¢å¼•ï¼ŒObj[Key] è¿”å›çš„æ˜¯ {} è€Œä¸æ˜¯ neverï¼Œæ‰€ä»¥è¿™æ ·åšä¸‹å…¼å®¹å¤„ç†ã€‚

å¦‚æœæœ‰ ref è¿™ä¸ªç´¢å¼•çš„è¯ï¼Œå°±é€šè¿‡ infer æå– Value çš„ç±»å‹è¿”å›ï¼Œå¦åˆ™è¿”å› neverã€‚

![GetRefProps 1](./imgs/5-22.webp)

å½“ ref ä¸º undefined æ—¶ï¼š

![GetRefProps 2](./imgs/5-23.webp)



- [TS Playground](https://www.typescriptlang.org/play?ts=4.5.0-beta#code/C4TwDgpgBA4hwCUIDMAKAnA9mAzgHg2xwD4oBeKAKChqgHJ0U6oIAPYCAOwBMcoBrCCEzIohXNVpSA-GKy4W7LrygBvKI2TSAXFACWnZBHRQAagEMANgFdoAHyjWeKAxG4BfSVO9RZFmxBePrS6nBAAbsZBUqERxgDclEmgkLDwSGjyOEg4AEzkaYgo4vjqmjqOzsiu3AA0UJzmALYQunTcmJwA5nTuxImUKdBwRZlEOQUjGSV4ZSgVAIz1jS1tHd29-UlAA)



## æ€»ç»“

å°±åƒå­—ç¬¦ä¸²å¯ä»¥åŒ¹é…ä¸€ä¸ªæ¨¡å¼ä¸²æå–å­ç»„ä¸€æ ·ï¼ŒTypeScript ç±»å‹ä¹Ÿå¯ä»¥åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹æå–æŸä¸ªéƒ¨åˆ†çš„ç±»å‹ã€‚

**TypeScript ç±»å‹çš„æ¨¡å¼åŒ¹é…æ˜¯é€šè¿‡ç±»å‹ `extends` ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼ŒæŠŠéœ€è¦æå–çš„éƒ¨åˆ†æ”¾åˆ°é€šè¿‡ `infer` å£°æ˜çš„å±€éƒ¨å˜é‡é‡Œï¼Œåé¢å¯ä»¥ä»è¿™ä¸ªå±€éƒ¨å˜é‡æ‹¿åˆ°ç±»å‹åšå„ç§åç»­å¤„ç†ã€‚** ğŸ‰

æ¨¡å¼åŒ¹é…çš„å¥—è·¯åœ¨æ•°ç»„ã€å­—ç¬¦ä¸²ã€å‡½æ•°ã€æ„é€ å™¨ã€ç´¢å¼•ç±»å‹ã€Promise ç­‰ç±»å‹ä¸­éƒ½æœ‰å¤§é‡çš„åº”ç”¨ï¼ŒæŒæ¡å¥½è¿™ä¸ªå¥—è·¯èƒ½æå‡å¾ˆå¤§ä¸€æˆªç±»å‹ä½“æ“æ°´å¹³ã€‚

- [TS Playgroundåˆé›†](https://www.typescriptlang.org/play?#code/PTAEm8fRo9UZXlFmTR1TUPexgAOUFj-pCEVoeH1CcyoWUTAtBUAXjQNeUAoMkUABQCcB7AWwEsBnAUwC4yAXATwAO7UAHF2PAGoBDADYBXdgBVB7ADzUAfKAC8NUOwAePdgDsAJqxoMWHVcxMAzdrVDT57LQH5XshaE6gJuwAbs4A3BT8QqLibgoASuyscjI8OjGSvkoq6tZsagDkAOZyUiZFBRoaERRUgA6mgCN+qLVgYjwAYsy0rDy8Khmd3TyqAIK0LobG5pZyJgDWJvQA7iYA2gC6WrpjE0amFqCr9k4ugz0ANKAAdDezC8tr6+ug3mdpAUGhtDVRwm1viWSqXS-y6PVUqwAjOcAEznADMmwivwGYJ4gJSPBhIPEbwhSJaGQAMlIen1om0SeCdvo9tNQHdFisNltQDTJvtLKsbldGQ8Npdjs5QFSeM9vKL-IEQuFIv1KaT0UlMTieKKIdC4YjquS-uJRRjUtjdArwSyalRqPQBDtdTRrTtRuNaVMDnzmZt0uy6QcNi9Ds8At7XVyeUKXICeJd3SZxaBI1LPrK7VaBIa0rpU46obCEQSUan08b7TbxvidYSAMoAC2YDh4tpRNbrDbLwc5DPmTMerPb9L93j9QedHP7McuYccwsjcYTHxl3zl0Wb9fT6RXrdoGtz2uR-Q3RfXtfr2YJlDAgHVtQBk3oAmOWa59AlZ4UloPFYAHVmDxq9wm8-Xx+X7VqoT67CGoA9LQ9hFJcdDsA4zAGC6HaQdBrKgch9IAAYACQAN5wQhBgAL74ah5TEVh-o8LQfgBA4sgcD8+7-m+n7fmuuhPi+bFAaoxSlOUoBlGYoBmPQ5QFJcAllBUOp-jxgEccqRrrqxSnATJQkiWJEkVNJ4mSRWD6JAIMhSAAxlwdqmeZVmgSBNGYQc5EwaA7TWM5liuZcij0F5EE0Wh6SPk5o4HLheHhlY8GIaReEeUw8XRZWcgOERlH+pFhFxfhfnxal6VxVRASgcx0S2ZZ7CcfG7BmVVDkAEQiIJRQlLJBSWAARkkaQOFB+ygGwLyNZcjWeKNoCNQAInphlFI18n9JVVmHroK3sE1UhdRZk3jXts3lPNi01A+ihQYwv79OdzCMKB8TMEU1bDBh4XeUF5ToWFPqWJF0WRvFBSgEDAA+wMADomKDEM8AUmXeDdd00Q9T3DJGWilTR5XCIjKPPTViP3Y9z38e1QmgBTlPAxWKKEzRRLwS933ga5X1gR2kVA9DBSQ9z4Ow8lU4Rr18OgHTtAM-Wqjo1KZVLjjF2S0qQIZmLF2gUr-FUxT82VNjau3Q5r0-YFUGfTo4t48M4ua6BVT67jKmq+LWva-NlN6xQD6AL+KdT3lQbTUC+UiMOIzisHagfB6HxjdKo7SzBZAUJyYFk8MwEmsinSdvaAAAUPIvkUrABNFYzFwAlDoWgxv65eWPOXz60HtAh2H3Q1VHrcx+Hqh5yYbcBD5wlFFwgRyIwPW0FX2haKze7RC3bex6wa0ZEvPdx3nM9zx9RQVgH4iJDwci0CYyhCJHR-iKf585NnyeJ+nmfpA-ucFzcRcl8JJh8BsO9DSFrVE+Z8L7CG8MfW+YDEwLn1pA0BKhDTAhNNfEBd8hB9wHqHIee8AEFF1gfVo4hFC1lYBvduYCyAWXMqwSwh0iigDwmQKmWCx6uRqFTCyElIJyDTvQWg29GHMO1hTb8bArisPSI1Y6EQqbEQoFTas7AZAyHoHnMR396FVyYSIimtAb5n2BkolR9BLgAElwYFEYMDUAABqUAGiJFt1kZTeR8iqHcLSO7XQQQligHodvCI80rjGNUYEigwTQn0CuBZWQMg854QMEkzgkJiIV31m0EhbByGxzAaoRQrJFABXUaQ0uQCsmsDAROT+tBi4BDKH-dYACGn+gqdAgIMYMnENITk5wYDASqgqb02geTfj0AcLpcoITlGqMIaAQAIeaAAIEwAFmr+yITwMxJgehlCspQlEbRNnbNTtkDBABhTxtE+EjP6LnXx+dC61O-g05pv8tDCIproc5WyaK8J4Pw6Btz2B+I-lcL+9Tf4AOioc58xzoHvO1t4aFOyTnCHhVTcFfAaj2FjgxKyNBw4SSESwweptoIRHcdi5wuLhDUAJSYL5PCrlEspr4-uJLXIVwCLS7oElyXywyEi2FiCkiqkFbsnI3LWASQZT8q5cy2gysuX82gwyI77PEIq35-DVWqHhZqq5AKTZ3JBWCn+fAXl8DIKyfVyrDXgWNQ8upgCTg0Gju3SpKgLXwu8Kqyh6LpRN35Qqi5WqVVupXgMlBPAbXavDb3SV0qQ1yotGAQARL6AFR9KAzRD5KgcHQa0Jcr65vzQIVguQC2snhQUfRDgga5zmOwPg4yrAFrRZTH1DBS0BTwqAGtngykuriMIMGswzCxSCGYeRuiEU+HcG2kRjdnDzpgYGotiQ82dtXiKqN66S1lp7X2gI0JAgkvwXpOGNN5TXw3QWwExY2i7s3aoA98F+2djHQhCdlxWEBDPZJYiFYgA)

![æ¨¡å¼åŒ¹é…æ€»ç»“](./imgs/5-24.webp)



2023å¹´03æœˆ07æ—¥15:42:29