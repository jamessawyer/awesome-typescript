---
title: æ–°è¯­æ³•infer extends
---

æˆ‘ä»¬çŸ¥é“ï¼ŒTypeScript æ”¯æŒ infer æ¥æå–ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼ã€‚

ğŸŒ°æ¯”å¦‚å…ƒç»„ç±»å‹æå–æœ€åä¸€ä¸ªå…ƒç´ çš„ç±»å‹ï¼š

```typescript
type Last<Arr extends unknown[]> =
  Arr extends [...infer rest, infer Ele]
    ? Ele
    : never
```

![Last](./imgs/16-1.webp)



ğŸŒ°æ¯”å¦‚å‡½æ•°æå–è¿”å›å€¼ç±»å‹ï¼š

```typescript
type GetReturnType<Func extends Function> =
  Func extends (...args: any[]) => infer R
    ? R
    : never
```

![GetReturnType](./imgs/16-2.webp)

ğŸŒ°æ¯”å¦‚å­—ç¬¦ä¸²æå–ä¸€éƒ¨åˆ†ï¼Œç„¶åæ›¿æ¢ï¼š

```typescript
// ä¸è€ƒè™‘å¤šä¸ªåŒ¹é…çš„æƒ…å†µï¼Œå³ä¸ä½¿ç”¨é€’å½’
type ReplaceStr<
  Str extends string,
  From extends string,
  To extends string
> = Str extends `${infer Prefix}${From}${infer Suffix}`
  ? `${Prefix}${To}${Suffix}`
  : Str
```

![ReplaceStr](./imgs/16-3.webp)



**æ¨¡å¼åŒ¹é…å°±æ˜¯é€šè¿‡ä¸€ä¸ªç±»å‹åŒ¹é…ä¸€ä¸ªæ¨¡å¼ç±»å‹ï¼Œéœ€è¦æå–çš„éƒ¨åˆ†é€šè¿‡ `infer` å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œè¿™æ ·å°±èƒ½ä»å±€éƒ¨å˜é‡é‡Œæ‹¿åˆ°æå–çš„ç±»å‹ã€‚**

infer çš„æ¨¡å¼åŒ¹é…ç”¨æ³•è¿˜æ˜¯æŒºå¥½ç†è§£çš„ã€‚

ä½†æ˜¯ infer æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚è¿™æ ·ï¼š

```typescript
type TestLast1<Arr extends string[]> =
  Arr extends [...infer rest, infer Last]
    ? `æœ€åä¸€ä¸ªæ˜¯ï¼š${Last}` // [!code error]
    : never
```

ğŸ“šä» string æ•°ç»„ä¸­æå–çš„å…ƒç´ ï¼Œé»˜è®¤ä¼šæ¨å¯¼ä¸º `unknown` ç±»å‹ï¼Œè¿™å°±å¯¼è‡´äº†ä¸èƒ½ç›´æ¥æŠŠå®ƒå½“ string ç”¨ï¼š

![TestLast](./imgs/16-4.webp)

é‚£æ€ä¹ˆåŠå‘¢ï¼Ÿ

ä¹‹å‰çš„å¤„ç†æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š

![TestLast fix 1](./imgs/16-5.webp)



åŠ ä¸€å±‚åˆ¤æ–­ï¼Œè¿™æ · Last å°±æ¨å¯¼ä¸º string ç±»å‹äº†ã€‚

æˆ–è€…ä¹Ÿå¯ä»¥å’Œ string **å–äº¤å‰ç±»å‹**ï¼š

![TestLast fix 2](./imgs/16-6.webp)

è¿™æ ·ä¹Ÿå¯ä»¥ä½œä¸º string æ¥ç”¨ã€‚

ä½†æ˜¯æˆ‘ä»¬æ˜æ˜çŸ¥é“è¿™é‡Œå°±æ˜¯ stringï¼Œå´è¿˜éœ€è¦ `& string` æˆ–è€… `xxx extends string` æ¥**è½¬æ¢**ä¸€æ¬¡ï¼Œè¿™ä¹Ÿå¤ªéº»çƒ¦äº†ã€‚

TS ä¹ŸçŸ¥é“æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥åœ¨ [v4.7](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-7.html#extends-constraints-on-infer-type-variables) å°±å¼•å…¥äº†æ–°è¯­æ³•ï¼š`infer extends`ğŸ‰ã€‚

ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š

![TestLast 4.7+ fix 3](./imgs/16-7.webp)

**infer çš„æ—¶å€™åŠ ä¸Š extends æ¥çº¦æŸæ¨å¯¼çš„ç±»å‹ï¼Œè¿™æ ·æ¨å¯¼å‡ºçš„å°±ä¸å†æ˜¯ unknown äº†ï¼Œè€Œæ˜¯çº¦æŸçš„ç±»å‹ã€‚**

ğŸ˜è¿™ä¸ªè¯­æ³•æ˜¯ TS 4.7 å¼•å…¥çš„ï¼Œåœ¨ [4.8](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-8.html#improved-inference-for-infer-types-in-template-string-types) åˆå®Œå–„äº†ä¸€ä¸‹ã€‚

æ¯”å¦‚è¿™æ ·ä¸€ä¸ªç±»å‹ï¼š

```typescript
type NumInfer<Str> =
  Str extends `${infer Num extends number}`
    ? Num
    : never
```

åœ¨ `4.7` çš„æ—¶å€™æ¨å¯¼ç»“æœæ˜¯è¿™æ ·ï¼š

![infer extends 4.7](./imgs/16-8.webp)

è€Œ `4.8` å°±æ˜¯è¿™æ ·äº†ï¼š

![infer extends 4.8](./imgs/16-13.webp)

ğŸ“š**ä¹Ÿå°±æ˜¯è¯´ 4.7 çš„æ—¶å€™æ¨å¯¼å‡ºçš„å°±æ˜¯ extends çº¦æŸçš„ç±»å‹ï¼Œä½†æ˜¯ 4.8 çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åŸºç¡€ç±»å‹ï¼Œä¼šæ¨å¯¼å‡ºå­—é¢é‡ç±»å‹ã€‚**

æœ‰äº†è¿™ä¸ªè¯­æ³•ä¹‹åï¼Œé™¤äº†èƒ½ç®€åŒ–ç±»å‹ç¼–ç¨‹çš„é€»è¾‘ä¹‹å¤–ï¼Œä¹Ÿèƒ½å®ç°ä¸€äº›ä¹‹å‰å®ç°ä¸äº†çš„åŠŸèƒ½ï¼š

æ¯”å¦‚æå–æšä¸¾çš„å€¼çš„ç±»å‹ï¼š

```typescript
enum Code {
  a = 111,
  b = 222,
  c = 'xyz'
}
```

æˆ‘ä»¬éƒ½æ˜¯è¿™æ ·å†™ï¼š

![enum to union](./imgs/16-9.webp)

ä½†æ˜¯æœ‰çš„å€¼æ˜æ˜æ˜¯æ•°å­—ï¼Œå´è¢«ä½œä¸ºäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¦å†å¤„ç†ä¸€ä¸‹ï¼Œè½¬æ¢æˆæ•°å­—ç±»å‹ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨ infer extends äº†ï¼š

```typescript
type StrToNum<Str> =
  Str extends `${infer Num extends number}`
    ? Num
    : Str
```

åšå®Œ string åˆ° number çš„è½¬æ¢ï¼Œå°±æ‹¿åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼š

![StrToNum](./imgs/16-10.webp)

è¿™å°±æ˜¯ infer extends çš„ç¬¬äºŒä¸ªä½œç”¨ã€‚

ğŸ“š**å¤„ç† string è½¬ number ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥è½¬ booleanã€null ç­‰ç±»å‹ï¼š**

![StrToBoolean](./imgs/16-11.webp)

![StrToNull](./imgs/16-12.webp)



## æ€»ç»“

Typescript æ”¯æŒ infer ç±»å‹ï¼Œå¯ä»¥é€šè¿‡æ¨¡å¼åŒ¹é…çš„æ–¹å¼ï¼Œæå–ä¸€éƒ¨åˆ†ç±»å‹è¿”å›ã€‚

ä½†æ˜¯ infer æå–å‡ºçš„ç±»å‹æ˜¯ `unknown`ï¼Œåé¢ç”¨çš„æ—¶å€™éœ€è¦ç±»ä¼¼å’Œ string å–äº¤å‰ç±»å‹ï¼Œæˆ–è€… `xxx extends string` è¿™æ ·çš„æ–¹å¼æ¥è½¬æ¢æˆåˆ«çš„ç±»å‹æ¥ç”¨ã€‚è¿™æ ·æ¯”è¾ƒéº»çƒ¦ã€‚

æ‰€ä»¥ `TS 4.7` å®ç°äº† infer extends çš„è¯­æ³•ï¼Œå¯ä»¥æŒ‡å®šæ¨å¯¼å‡ºçš„ç±»å‹ï¼Œè¿™æ ·ç®€åŒ–äº†ç±»å‹ç¼–ç¨‹ã€‚

è€Œä¸”ï¼Œinfer extends è¿˜å¯ä»¥ç”¨æ¥åšç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚ string è½¬ numberã€è½¬ boolean ç­‰ã€‚

è¦æ³¨æ„çš„æ˜¯ï¼Œ4.7 çš„æ—¶å€™ï¼Œæ¨å¯¼å‡ºçš„åªæ˜¯ extends çº¦æŸçš„ç±»å‹ï¼Œæ¯”å¦‚ numberã€booleanï¼Œä½†æ˜¯ `4.8` å°±èƒ½æ¨å¯¼å‡ºå­—é¢é‡ç±»å‹äº†ï¼Œæ¯”å¦‚ 1ã€2ã€trueã€false è¿™ç§ã€‚

æœ‰äº† infer extendsï¼Œä¸ä½†èƒ½ç®€åŒ–ç±»å‹ç¼–ç¨‹ï¼Œè¿˜èƒ½å®ç°ä¸€äº›ä¹‹å‰å¾ˆéš¾å®ç°çš„ç±»å‹è½¬æ¢ï¼Œæ˜¯å¾ˆæœ‰ç”¨çš„ä¸€ä¸ªæ–°è¯­æ³•ã€‚





- [TS4.7 extends Constraints on infer Type Variables](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-7.html#extends-constraints-on-infer-type-variables)
- [TS4.8 Improved Inference for infer Types in Template String Types](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-4-8.html#improved-inference-for-infer-types-in-template-string-types)

- åŸæ–‡é“¾æ¥
  - [å¿«é€ŸæŒæ¡ TypeScript æ–°è¯­æ³•ï¼šinfer extends - @æ˜é‡‘](https://juejin.cn/post/7133438765317488677)

2023-03-16 11:22:05

